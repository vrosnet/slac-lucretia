<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>


  
  <meta content="en-us" http-equiv="Content-Language" />

  
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><title>External Process Interface</title></head><body>
<div style="text-align: center;"><a href="http://www.slac.stanford.edu/accel/ilc/codes/Lucretia/"><span style="font-size: 24pt;"> <img src="LucretiaLogo.gif" alt="LucretiaLogo" style="border: 0px solid ; width: 80px; height: 90px;" align="right" hspace="20" /></span></a><span style="font-size: 24pt;"><br />
</span>
<div style="text-align: center;"><span style="font-size: 24pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
The <span style="color: rgb(214, 0, 147);">LUCRETIA</span>
Project</span><br />
</div>
<span style="font-size: 24pt;"><br />
<small>Interface Routines to Access External Processes<br />
<br />
</small></span><br />
<div style="text-align: left;">
<div style="text-align: center;">
<div style="text-align: left;">
<div style="text-align: center;">
<div style="text-align: left;"> Interface routines between Lucretia and
other modeling software tools are handled by the ExtProcess.m class and
other class files in the src/ExtProcess directory. These provide the
tools to link the Lucretia data structures and underlying tracking
engine to other modeling software, and also handle returning processed
data back into the Lucretia Matlab environment. The ExtProcess library
of classes perform this function by modifying and extending the
functionality of the standard Lucretia data structures. The external
codes which Lucretia currently supports are listed below:<br />
<div> </div>
<ul><li>
    <div><a href="web/extProcess_geant4.html">GEANT4</a>
    </div>
  </li></ul>
The upper-level classes: ExtProcess.m, ExtGeometry.m and
ExtSecondaryParticles.m define global interfaces which are ineherited
by the underlying classes supportng the above external processes which provide interface support to the specific
codes.<br />

<h3 style="color: rgb(51, 102, 255);">ExtProcess.m</h3>The public (Static) method <span style="font-style: italic;">new</span>
is invoked to spawn a new external process of requested type and
attaches this object to a BEAMLINE element to which it is associated.<br />

<h4>Public properties</h4>
<ul><li>MaxSecondaryParticles = 0</li><ul><li>Controls the generation
of secondary particles (not necessarily just electrons) from external
processes. Setting &gt;0 will allow for the storage of this max number
of secondary particles.<br /></li></ul><li>MaxPrimaryParticles = 1e4</li><ul><li>Controls the max number of Lucretia macro particles (from the Lucretia <a href="web/beam.html">Beam</a>
structure) to be passed to the external process. If this number is &lt;
the number of macro particles in the Lucretia Bunch under
consideration, the default behaviour when using the <a href="web/tracking.html#Track">Track</a>
class is to choose a selection of particles to pass to the external
process using the SetPrimaryOrdering method of this class. If manually
tracking with <a href="web/tracking.html#TrackThru">TrackThru</a> then either call this method directly on the instantiated process object or the default behaviour is to take the first <span style="font-style: italic;">MaxPrimaryParticles</span> in the bunch.<br /></li></ul><li>MaxSecondaryParticlesPerPrimary = 10</li><ul><li>Max number of secondary particles to allow per provided primary particle (overall limit of <span style="font-style: italic;">MaxSecondaryParticles</span> still applies)<br /></li></ul><li>NumSecondariesStored = 0 <br /></li><ul><li>Number of secondary particles actually stored (set by the tracking code).</li></ul>
  <li>PrimaryParticlesData / SecondaryParticlesData</li>
  <ul>
    <li>Storage area for data generated by Ext process reslated to
primary particles (Lucretia Bunch rays) and secondary particles (if
requested and cuts passed for storage criteria) respectively. These
entries are objects of ExtPrimaryParticles and ExtSecondaryParticles
classes respectively, an array of such objects is generated, one entry
per bunch tracked if multi-bunch tracking performed.<br />
    </li>
  </ul>
</ul>
<h4>Public methods</h4>
<ul>
  
  <li>InitializeTracking / FinalizeTracking<span style="font-style: italic;" /></li>

  
  
  <ul>

    
    <li>Called automatically by Track object at the beginning and end
of tracking to setup and move memory areas for storage of data from Ext
process. If you wish to track manually using the TrackThru function,
you need to call these methods yourself for all ExtProcess derived
objects attached to the BEAMLINE array.<br />
InitializeTracking sets the order of particles from the Lucretia <span style="font-style: italic;">primaryBeam</span> structure to sample macro-particles up to the limit set by <span style="font-style: italic;">MaxPrimaryParticles</span>. This sets the property <span style="font-style: italic;">PrimarySampleOrder</span>
which is a cell array containing indices which point to the macro
particles in the Bunches of the provided Beam structure. Each index
vector is the order in which the primary beam particles are read into
the external process up to the <span style="font-style: italic;">MaxPrimaryParticles</span>
limit. The order is set so the highest weighted (charge)
macro-particles are selected first, where multiple macro-particles have
identical charge weight then these are randomized. This method is
called automatically from the Track class.
    </li>

  
  </ul>

</ul><h4>Static methods</h4>
<ul>
  <li>new(<span style="font-style: italic;">processType,elemno,[parameter list...]</span>)</li>
  <ul>
    <li>Instantiate a new extProcess object of the type <span style="font-style: italic;">processType</span> (e.g. 'GEANT4') which associates to the BEAMLINE element <span style="font-style: italic;">elemno</span>. This attaches an object called 'ExtProcess' to the given BEAMLINE element of class given by<span style="font-style: italic;"><span style="font-style: italic;"><span style="font-style: italic;"> processType. </span></span></span>Optionally pass a list of public property, value pairs which get applied to the instantiated object.<br />
    </li>
  </ul>
</ul>
<h3 style="color: rgb(51, 102, 255);">ExtGeometry.m</h3>
Defines geometrical objects associated with external processes. The
objects are assumed to have length determined by the associated
BEAMLINE element and where available the other properties take their
default values from properties of the BEAMLINE element. The <span style="font-style: italic;">GeometryType</span> property defines the cross-sectional shape, with provided thickess.<br />
<h4>Properties (Set Access protected)<br />
</h4>
<ul>
  <li>GeometryType='Ellipse'<br />
  </li>
  <ul>
    <li>Type of shape (e.g. 'Rectangle'). Set with <span style="font-style: italic;">SetGeometry</span> method, choose from list in <span style="font-style: italic;">allowedGeometryTypes</span> cell array list.<br />
    </li>
  </ul>
  <li>AperX=1</li>
  <ul>
    <li>Inside half-aperture of shape (m) - Horizontal dimension. Set with <span style="font-style: italic;">SetAper</span> method.<br />
    </li>
  </ul>
  <li>AperY=1</li>
  <ul>
    <li>Inside half-aperture of shape (m) - Vertical dimension. Set with <span style="font-style: italic;">SetAper</span> method.</li>
  </ul>
  <li>Thickness=1</li>
  <ul>
    <li>Geometry thickness (m). Set with <span style="font-style: italic;">SetThickness</span> method.<br />
    </li>
  </ul>
  <li>Material='Vacuum'</li>
  <ul>
    <li>Material type. Choose from list in <span style="font-style: italic;">allowedMaterials </span>property. Set with <span style="font-style: italic;">SetMaterial</span> method.</li>
  </ul>
</ul>
<h3 style="color: rgb(51, 102, 255);">ExtPrimaryParticles.m</h3>
<h4>Public properties</h4>
<ul>
  <li>regeneratedID</li>
  <ul>
    <li>List of particles stopped by Lucretia (Aperture exceeded),
passed to Ext process and then un-stopped and re-entered into Lucretia
tracking routine by Ext process for a given BEAMLINE element location.</li>
  </ul>
</ul>
<h3 style="color: rgb(51, 102, 255);">ExtSecondaryParticles.m</h3>
Storage class for secondary particles generated by Ext process, only
particles which pass defined cuts are stored up to the maximum
requested.<br />
<h4>Public properties</h4>
<ul>
  <li>NumStored</li>
  <ul>
    <li>Number of secondary particles for this element actually stored by Ext process code.<br />
    </li>
  </ul>
  <li>Pos</li>
  <ul>
    <li>[6,<span style="font-style: italic;">NumStored</span>] array of stored secondary particle ray coordinates (in usual Lucretia <a href="web/beam.html">Beam</a> Bunch format).</li>
  </ul>
  <li>PrimaryID</li>
  <ul>
    <li>Link to primary particle ID (Lucretia Beam Bunch ray index) that created this secondary (or parent theerof).</li>
  </ul>
  <li>ParticleType</li>
  <ul>
    <li>Cell array of particle type names.<br />
    </li>
  </ul>
</ul>




<h4><a href="http://www.slac.stanford.edu/owner/whitegr">whitegr</a><br />
</h4>

8-Apr-2014<a href="http://www.slac.stanford.edu/detailed.html"><img src="SLAC_whitebkgd.jpg" title="Return to SLAC detailed home page" alt="SLAC-logo" style="border: 0px solid ; width: 100px; height: 39px;" align="right" /></a></div>
</div>
</div>
</div>
</div></div>
</body></html>